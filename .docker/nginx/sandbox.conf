
server {
        listen 80;
        server_name ta.cic.kz www.ta.cic.kz nginx.ta.cic.kz;
        return 301 https://$host$request_uri;
}

server {
        #set $host_path "/home/cfo/cfo/public";
        #set $host_path "/home/my.cic.kz/test/current/public";
        #set $host_path "/home/my.cic.kz/deploy/prod/releases/29/public";
        #set $host_path "/home/deploy/my.cic.kz/public";
        #set $host_path "/home/my.cic.kz/test/releases/268/public";
        set $host_path "/hdd2tb/www/mycic/test/current/public";

        charset utf-8;
        client_max_body_size 128M;

        # Listen to Centras proxy HTTPS
        listen 8080;

        root $host_path;
        index index.php;

        server_name ta.cic.kz www.ta.cic.kz nginx.ta.cic.kz;

        #gzip on;
        gzip_comp_level 5;
        gzip_min_length 256;
        #gzip_proxied any;
        #gzip_vary on;
        #gzip_types
        #       application/atom+xml
#               application/javascript
#               application/json
#               application/rss+xml
#               application/vnd.ms-fontobject
#               application/x-font-ttf
#               application/x-javascript
#               application/x-web-app-manifest+json
#               application/xhtml+xml
#               application/xml
#               font/opentype
#               image/svg+xml
#               image/x-icon
#               text/css
#               text/javascript
#               text/plain
#               text/x-component;


#        if ( $redirect_uri ) {
#            return 302 $redirect_uri;
#        }

        location / {
                try_files $uri $uri/ /index.php?$query_string;
        }

        location = /favicon.ico { access_log off; log_not_found off;}
        location = /robots.txt  { access_log off; log_not_found off;}

        access_log off;

        error_page 404 /index.php;

        sendfile off;

        # Only for nginx-naxsi used with nginx-naxsi-ui : process denied requests
        #location /RequestDenied {
        #       proxy_pass http://127.0.0.1:8080;
        #}

        location ~ \.(js|css|png|jpg|gif|swf|ico|pdf|mov|fla|zip|rar)$ {
           try_files $uri =404;
        }
        #error_page 404 /404.html;

        # redirect server error pages to the static page /50x.html
        #
        #error_page 500 502 503 504 /50x.html;
        #location = /50x.html {
        #       root /usr/share/nginx/html;
        #}

        # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
        #
        location ~ \.php$ {
                fastcgi_split_path_info ^(.+\.php)(/.+)$;
                # NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
        #
        #       # With php5-cgi alone:
        #       fastcgi_pass 127.0.0.1:9000;
        #       # With php7.1-pm:
                fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
#               fastcgi_pass unix:/var/run/php/php7.1-fpm.sock;
                fastcgi_index index.php;
                include fastcgi_params;
                fastcgi_param SCRIPT_FILENAME $document_root/$fastcgi_script_name;
                fastcgi_read_timeout 300;
        #       fastcgi_buffers 16 32k;
        #       fastcgi_buffer_size 32k;

        }

#       error_page 500 502 503 504 /custom_50x.html;
#        location = /custom_50x.html {
#                root /usr/share/nginx/html;
#                internal;
#        }
#
        location ~ /\.(ht|git) {
                deny all;
        }
#
#       location /media/OgpoOrder/ {
#               internal;
#               alias $host_path/media/OgpoOrder/;
#       }
#       location /media/KaskoOrder/ {
#               internal;
#               alias $host_path/media/KaskoOrder/;
#       }
#       location /media/TourOrder/ {
#               internal;
#               alias $host_path/media/TourOrder/;
#       }
#       location /media/PropertyOrder/ {
#               internal;
#               alias $host_path/media/PropertyOrder/;
#       }
#       location /media/User/ {
#               internal;
#               alias $host_path/media/User/;
#       }

}


# another virtual host using mix of IP-, name-, and port-based configuration
#
#server {
#       listen 8000;
#       listen somename:8080;
#       server_name somename alias another.alias;
#       root html;
#       index index.html index.htm;
#
#       location / {
#               try_files $uri $uri/ =404;
#       }
#}


# HTTPS server
#
#server {
#       listen 443;
#       server_name localhost;
#
#       root html;
#       index index.html index.htm;
#
#       ssl on;
#       ssl_certificate cert.pem;
#       ssl_certificate_key cert.key;
#
#       ssl_session_timeout 5m;
#
#       ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
#       ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
#       ssl_prefer_server_ciphers on;
#
#       location / {
#               try_files $uri $uri/ =404;
#       }
#}
